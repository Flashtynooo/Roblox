-- UWU Flashy System - Fe fighting tool + GUI styled + Shiftlock horizontal

-- Anti-fling
loadstring(game:HttpGet("https://raw.githubusercontent.com/Flashtynooo/Roblox/refs/heads/Fighting-style/Antifling"))()

local plr = game:GetService("Players").LocalPlayer
local char = plr.Character or plr.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")
local pack = plr:WaitForChild("Backpack")
local uis = game:GetService("UserInputService")
local rs = game:GetService("RunService")

-- R15 check
if hum.RigType == Enum.HumanoidRigType.R15 then
	local msg = Instance.new("Message", workspace)
	msg.Text = "‚ùå R15 is not supported. Switch to R6."
	task.delay(4, function() msg:Destroy() end)
	return
end

-- Clean old
if workspace:FindFirstChild("aaa") then
	workspace:FindFirstChild("aaa"):Destroy()
end

-- Animation setup
local animIDs = {"rbxassetid://313762630", "rbxassetid://248336677"}
local animator = hum:WaitForChild("Animator")
local animations = {}
for i, id in ipairs(animIDs) do
	local animation = Instance.new("Animation")
	animation.AnimationId = id
	animation.Name = "aaa_" .. i
	animation.Parent = workspace
	table.insert(animations, animation)
end

-- Tool
local tool = Instance.new("Tool")
tool.Name = "Fe floating true-flshty (R6)"
tool.RequiresHandle = false
tool.Parent = pack
tool.ToolTip = "flshty_user fighting awake :)"

-- GUI
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "FlshtyButtons"
gui.ResetOnSpawn = false
gui.Enabled = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 70, 0, 250)
frame.Position = UDim2.new(1, -80, 0.5, -125)
frame.BackgroundTransparency = 1

-- Boutons styl√©s
local function createBtn(text)
	local btn = Instance.new("TextButton", frame)
	btn.Size = UDim2.new(1, 0, 0, 50)
	btn.BackgroundColor3 = Color3.fromRGB(130, 0, 255)
	btn.TextColor3 = Color3.fromRGB(0, 255, 255)
	btn.Font = Enum.Font.Arcade
	btn.Text = text
	btn.TextScaled = true
	local uic = Instance.new("UICorner", btn)
	uic.CornerRadius = UDim.new(0, 14)
	local stroke = Instance.new("UIStroke", btn)
	stroke.Color = Color3.fromRGB(255, 20, 147)
	stroke.Thickness = 2
	return btn
end

local buttonZ = createBtn("Z")
buttonZ.Position = UDim2.new(0, 0, 0, 0)

local buttonE = createBtn("E")
buttonE.Position = UDim2.new(0, 0, 0, 60)

local buttonX = createBtn("X")
buttonX.Position = UDim2.new(0, 0, 0, 120)

local buttonLock = createBtn("üîí")
buttonLock.Position = UDim2.new(-1.3, 0, 0, 200)

-- ** Nouveau bouton Stop Anim **
local buttonStopAnim = createBtn("Stop Anim")
buttonStopAnim.Position = UDim2.new(0, 0, 0, 180)
buttonStopAnim.Visible = false -- cach√© par d√©faut

-- Cooldowns
local cd = {E = false, Z = false, X = false, LOCK = false}
local function cooldown(key, duration)
	cd[key] = true
	task.delay(duration, function() cd[key] = false end)
end

-- Execution fonctions pour boutons Z, E, X
local function exeE()
	if cd.E or not gui.Enabled then return end
	cooldown("E", 2)
	loadstring(game:HttpGet("https://raw.githubusercontent.com/Flashtynooo/Roblox/refs/heads/Fighting-style/Finder"))()
end

local function exeZ()
	if cd.Z or not gui.Enabled then return end
	cooldown("Z", 2)
	loadstring(game:HttpGet("https://raw.githubusercontent.com/Flashtynooo/Roblox/refs/heads/Fighting-style/Z"))()
end

local function exeX()
	if cd.X or not gui.Enabled then return end
	cooldown("X", 0.2)
	loadstring(game:HttpGet("https://raw.githubusercontent.com/Flashtynooo/Roblox/refs/heads/Fighting-style/DASH%20LIGHT"))()
end

-- Shiftlock system
local shiftlockActive = false
local shiftConn
local function getClosestPlayer()
	local closest, dist = nil, math.huge
	for _, p in pairs(game:GetService("Players"):GetPlayers()) do
		if p ~= plr and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
			local d = (p.Character.HumanoidRootPart.Position - char.HumanoidRootPart.Position).Magnitude
			if d < dist then
				dist = d
				closest = p
			end
		end
	end
	return closest
end

local function toggleShiftlock()
	if cd.LOCK then return end
	cooldown("LOCK", 0.2)
	shiftlockActive = not shiftlockActive
	if shiftlockActive then
		shiftConn = rs.RenderStepped:Connect(function()
			local target = getClosestPlayer()
			if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
				local root = char:FindFirstChild("HumanoidRootPart")
				local targetPos = Vector3.new(target.Character.HumanoidRootPart.Position.X, root.Position.Y, target.Character.HumanoidRootPart.Position.Z)
				root.CFrame = CFrame.new(root.Position, targetPos)
			end
		end)
	else
		if shiftConn then shiftConn:Disconnect() shiftConn = nil end
	end
end

-- Connexions boutons
buttonE.MouseButton1Click:Connect(exeE)
buttonZ.MouseButton1Click:Connect(exeZ)
buttonX.MouseButton1Click:Connect(exeX)
buttonLock.MouseButton1Click:Connect(toggleShiftlock)

-- Bouton Stop Anim
local REDUCED_WALK_SPEED = 1
local NORMAL_WALK_SPEED = 16
local frozenAnimTracks = {}

local function gradualWalkSpeedRestore(duration)
	local startSpeed = hum.WalkSpeed
	local targetSpeed = NORMAL_WALK_SPEED
	local steps = 20
	local stepTime = duration / steps
	
	for i = 1, steps do
		local alpha = i / steps
		hum.WalkSpeed = startSpeed + (targetSpeed - startSpeed) * alpha
		task.wait(stepTime)
	end
	hum.WalkSpeed = targetSpeed
end

local function playFrozenAnimations()
	hum.WalkSpeed = REDUCED_WALK_SPEED
	
	-- Anim 1 - loop = false, play speed 3, freeze √† 1.5s
	local anim1 = Instance.new("Animation")
	anim1.AnimationId = "rbxassetid://184574340"
	local track1 = hum:LoadAnimation(anim1)
	track1.Looped = false
	track1:Play(0, 1, 3)
	track1.TimePosition = 1.5
	task.delay(0.1, function() track1:AdjustSpeed(0) end)
	
	-- Anim 2 - loop true, speed 3
	local anim2 = Instance.new("Animation")
	anim2.AnimationId = "rbxassetid://33796059"
	local track2 = hum:LoadAnimation(anim2)
	track2.Looped = true
	track2:Play(0, 1, 3)
	
	-- Anim 3 - loop true, speed 3
	local anim3 = Instance.new("Animation")
	anim3.AnimationId = "rbxassetid://180612465"
	local track3 = hum:LoadAnimation(anim3)
	track3.Looped = true
	track3:Play(0, 1, 3)
	
	frozenAnimTracks = {track1, track2, track3}
end

buttonStopAnim.MouseButton1Click:Connect(function()
	-- Stop les anims persos
	for _, t in ipairs(frozenAnimTracks) do
		if t and t.IsPlaying then
			t:Stop()
		end
	end
	frozenAnimTracks = {}
	
	-- Remonter la vitesse doucement (en t√¢che parall√®le)
	task.spawn(function()
		gradualWalkSpeedRestore(2)
	end)
end)

-- Clavier
uis.InputBegan:Connect(function(input, gpe)
	if gpe or not gui.Enabled then return end
	if input.KeyCode == Enum.KeyCode.E then exeE() end
	if input.KeyCode == Enum.KeyCode.Z then exeZ() end
	if input.KeyCode == Enum.KeyCode.X then exeX() end
end)

local animTracks = {}
tool.Equipped:Connect(function()
	gui.Enabled = true
	buttonStopAnim.Visible = true -- afficher bouton stop anim
	
	playFrozenAnimations() -- lance nos anims persos en priorit√©
	
	pcall(function()
		loadstring(game:HttpGet("https://raw.githubusercontent.com/Flashtynooo/Roblox/refs/heads/Fighting-style/Fling%20on"))()
	end)
	for _, a in ipairs(animations) do
		local t = animator:LoadAnimation(a)
		t:Play()
		t:AdjustSpeed(0.5)
		t.TimePosition = 0.5
		table.insert(animTracks, t)
	end
end)

tool.Unequipped:Connect(function()
	gui.Enabled = false
	buttonStopAnim.Visible = false -- cacher bouton stop anim
	
	pcall(function()
		loadstring(game:HttpGet("https://raw.githubusercontent.com/Flashtynooo/Roblox/refs/heads/Fighting-style/Fling%20off"))()
	end)
	-- Stop anims persos et reset vitesse progressivement
	for _, t in ipairs(frozenAnimTracks) do
		if t then t:Stop() t:Destroy() end
	end
	frozenAnimTracks = {}
	
	for _, t in ipairs(animTracks) do
		if t then t:Stop() t:Destroy() end
	end
	animTracks = {}
	
	if shiftConn then shiftConn:Disconnect() shiftConn = nil end
	hum.WalkSpeed = NORMAL_WALK_SPEED
end)

tool.Parent = pack
