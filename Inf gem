-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalizationService = game:GetService("LocalizationService")

-- Joueur
local player = Players.LocalPlayer

-- Traductions du message
local translations = {
    ["fr"] = "tu as déjà des gems infinis, si j'en ajoute plus tu passes en -inf",
    ["es"] = "ya tienes gemas infinitas, si agrego más obtendrás -inf",
    ["de"] = "du hast bereits unendlich viele Juwelen, wenn ich mehr gebe, bekommst du -inf",
    ["pt"] = "você já tem gemas infinitas, se eu der mais, você terá -inf",
    ["it"] = "hai già gemme infinite, se ne aggiungo altre avrai -inf",
    ["ru"] = "у тебя уже бесконечные гемы, если добавить ещё — будет -inf",
    ["ja"] = "すでに無限のジェムを持っています。もっと与えると -inf になります",
    ["ko"] = "이미 무한 젬을 가지고 있어요. 더 주면 -inf 됩니다",
    ["zh"] = "你已经有无限宝石了，再多就会变成负无限",
    ["en"] = "you have already inf gem if I get more you get -inf",
}

-- Langue du joueur
local function getPlayerLanguage()
    local localeId = LocalizationService.RobloxLocaleId
    return string.sub(localeId, 1, 2)
end

-- Afficher message stylé
local function showMessage(text)
    local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
    gui.Name = "GemWarningMessage"

    local label = Instance.new("TextLabel", gui)
    label.Size = UDim2.new(0.7, 0, 0.2, 0)
    label.Position = UDim2.new(0.5, 0, 0.45, 0)
    label.AnchorPoint = Vector2.new(0.5, 0.5)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 0, 0)
    label.TextScaled = true
    label.Font = Enum.Font.GothamBlack

    -- Fade out progressif
    for i = 1, 30 do
        label.TextTransparency = i / 30
        task.wait(0.1)
    end
    gui:Destroy()
end

-- Fonction principale
coroutine.wrap(function()
    local hasExecuted = getgenv().GemGiven or false
    local gemValue = player:FindFirstChild("gem") and tonumber(player.gem.Value) or 0

    if hasExecuted or gemValue >= 1e+20 then
        -- Jouer le son fort
        local sound = Instance.new("Sound")
        sound.SoundId = "rbxassetid://8400918001"
        sound.Volume = 10
        sound.Looped = false
        sound.Parent = workspace
        sound:Play()

        -- Afficher le message traduit
        local lang = getPlayerLanguage()
        local text = translations[lang] or translations["en"]
        showMessage(text)
    else
        -- Marquer comme déjà exécuté
        getgenv().GemGiven = true

        -- Donner les gems
        local args = {
            "Gems",
            100000000000000000000000000000000000000
        }
        ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("AddRewardEvent"):FireServer(unpack(args))
    end
end)()
