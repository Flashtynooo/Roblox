_G.Sections = _G.Sections or {}

_G.Sections.settings = function(parent)
    parent:ClearAllChildren()

    -- Cadre principal (fond noir)
    local Frame = Instance.new("Frame", parent)
    Frame.Size = UDim2.new(1, 0, 1, 0)
    Frame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
    Frame.ClipsDescendants = true
    Frame.AnchorPoint = Vector2.new(0, 0)
    Frame.Position = UDim2.new(0, 0, 0, 0)
    local UICornerFrame = Instance.new("UICorner", Frame)
    UICornerFrame.CornerRadius = UDim.new(0, 15)

    -- Cadre avec bordure néon vert
    local UIStroke = Instance.new("UIStroke", Frame)
    UIStroke.Thickness = 3
    UIStroke.Color = Color3.fromRGB(0, 255, 128)
    UIStroke.Transparency = 0
    UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

    -- Titre
    local Title = Instance.new("TextLabel", Frame)
    Title.Size = UDim2.new(1, 0, 0, 40)
    Title.Position = UDim2.new(0, 0, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "Settings"
    Title.TextColor3 = Color3.fromRGB(0, 255, 128)
    Title.Font = Enum.Font.Gotham
    Title.TextScaled = true

    -- ScrollingFrame pour les boutons
    local Scroll = Instance.new("ScrollingFrame", Frame)
    Scroll.Size = UDim2.new(1, -20, 1, -100) -- moins haut pour place boutons bas
    Scroll.Position = UDim2.new(0, 10, 0, 50)
    Scroll.BackgroundTransparency = 1
    Scroll.BorderSizePixel = 0
    Scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    Scroll.ScrollBarThickness = 6
    Scroll.VerticalScrollBarInset = Enum.ScrollBarInset.Always
    Scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y

    local UIListLayout = Instance.new("UIListLayout", Scroll)
    UIListLayout.Padding = UDim.new(0, 8)
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

    -- Fonction pour créer un bouton simple flshty style noir/vert
    local function createButton(name, callback)
        local btn = Instance.new("TextButton", Scroll)
        btn.Size = UDim2.new(0.95, 0, 0, 40)
        btn.BackgroundColor3 = Color3.fromRGB(0, 50, 20)
        btn.TextColor3 = Color3.fromRGB(0, 255, 128)
        btn.Font = Enum.Font.Gotham
        btn.TextScaled = true
        btn.Text = name
        local uicorner = Instance.new("UICorner", btn)
        uicorner.CornerRadius = UDim.new(0, 12)
        local uistroke = Instance.new("UIStroke", btn)
        uistroke.Color = Color3.fromRGB(0, 255, 128)
        uistroke.Thickness = 0.5

        btn.MouseButton1Click:Connect(function()
            pcall(callback)
            btn.AutoButtonColor = false
            btn.BackgroundColor3 = Color3.fromRGB(0, 30, 12)
            btn.Text = "✔️ " .. name
        end)
    end

    -- Fonction pour créer un toggle flshty style noir/vert
    local function createToggle(name, onText, offText, onFunc, offFunc, defaultState)
        local state = defaultState
        local btn = Instance.new("TextButton", Scroll)
        btn.Size = UDim2.new(0.95, 0, 0, 40)
        btn.BackgroundColor3 = Color3.fromRGB(0, 50, 20)
        btn.TextColor3 = Color3.fromRGB(0, 255, 128)
        btn.Font = Enum.Font.Gotham
        btn.TextScaled = true
        btn.Text = state and (onText .. " (ON)") or (offText .. " (OFF)")
        local uicorner = Instance.new("UICorner", btn)
        uicorner.CornerRadius = UDim.new(0, 12)
        local uistroke = Instance.new("UIStroke", btn)
        uistroke.Color = Color3.fromRGB(0, 255, 128)
        uistroke.Thickness = 1

        btn.MouseButton1Click:Connect(function()
            state = not state
            if state then
                pcall(onFunc)
                btn.Text = onText .. " (ON)"
            else
                pcall(offFunc)
                btn.Text = offText .. " (OFF)"
            end
        end)
    end

    -- Ajout des boutons avec leur logique

    createButton("Remove Fog / Blur", function()
        local l = game:GetService("Lighting")
        for _, v in pairs(l:GetChildren()) do
            if v:IsA("BlurEffect") or v:IsA("DepthOfFieldEffect") or v:IsA("SunRaysEffect") then
                v:Destroy()
            end
        end
        l.FogStart = 999999
        l.FogEnd = 999999
    end)

    createButton("Remove Sky", function()
        for _, v in pairs(game:GetService("Lighting"):GetChildren()) do
            if v:IsA("Sky") then v:Destroy() end
        end
    end)

    createButton("Fullbright", function()
        local l = game:GetService("Lighting")
        l.Brightness = 3
        l.ClockTime = 12
        l.FogEnd = 1e10
        l.GlobalShadows = false
    end)

    createToggle("Fling", "Fling", "Fling", function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Flashtynooo/Roblox/refs/heads/Fighting-style/Fling%20on"))()
    end, function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Flashtynooo/Roblox/refs/heads/Fighting-style/Fling%20off"))()
    end, false)

    createToggle("Antifling", "Antifling", "Antifling", function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Flashtynooo/Roblox/refs/heads/Fighting-style/Antifling"))()
    end, function()
        _G.g_antiFling = false
    end, false)

    -- Boutons fixes en bas hors scrolling
    local function createFixedButton(name, callback)
        local btn = Instance.new("TextButton", Frame)
        btn.Size = UDim2.new(0.45, 0, 0, 40)
        btn.Position = UDim2.new(name == "Rejoin" and 0.05 or 0.5, 0, 1, -45)
        btn.BackgroundColor3 = Color3.fromRGB(0, 50, 20)
        btn.TextColor3 = Color3.fromRGB(250, 255, 128)
        btn.Font = Enum.Font.Gotham
        btn.TextScaled = true
        btn.Text = name
        local uicorner = Instance.new("UICorner", btn)
        uicorner.CornerRadius = UDim.new(0, 12)
        local uistroke = Instance.new("UIStroke", btn)
        uistroke.Color = Color3.fromRGB(0, 255, 128)
        uistroke.Thickness = 0.5

        btn.MouseButton1Click:Connect(function()
            pcall(callback)
            btn.AutoButtonColor = false
            btn.BackgroundColor3 = Color3.fromRGB(0, 30, 12)
            btn.Text = ":) " .. name
        end)
    end

    createFixedButton("Rejoin", function()
        local ts = game:GetService("TeleportService")
        local p = game.Players.LocalPlayer
        ts:Teleport(game.PlaceId, p)
    end)

    createFixedButton("Serverhop", function()
        local HttpService = game:GetService("HttpService")
        local TeleportService = game:GetService("TeleportService")
        local PlaceId = game.PlaceId
        local ServerListUrl = "https://games.roblox.com/v1/games/" .. PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"

        local function requestServerList(cursor)
            local url = ServerListUrl
            if cursor then
                url = url .. "&cursor=" .. cursor
            end
            local success, response = pcall(function()
                return game:HttpGet(url)
            end)
            if success and response then
                return HttpService:JSONDecode(response)
            else
                return nil
            end
        end

        local function teleportToNewServer()
            local servers = requestServerList()
            if not servers or not servers.data then return end

            local server
            local p = game.Players.LocalPlayer
            local serverId = nil

            for _, s in pairs(servers.data) do
                if s.playing < s.maxPlayers then
                    serverId = s.id
                    break
                end
            end

            if serverId then
                TeleportService:TeleportToPlaceInstance(PlaceId, serverId, p)
            else
                warn("No server found to teleport.")
            end
        end

        teleportToNewServer()
    end)
end
