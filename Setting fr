_G.Sections = _G.Sections or {}

_G.Sections.settings = function(parent)
    parent:ClearAllChildren()

    -- Cadre principal (fond noir)
    local Frame = Instance.new("Frame", parent)
    Frame.Size = UDim2.new(1, 0, 1, 0)
    Frame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
    Frame.ClipsDescendants = true
    Frame.AnchorPoint = Vector2.new(0, 0)
    Frame.Position = UDim2.new(0, 0, 0, 0)
    local UICornerFrame = Instance.new("UICorner", Frame)
    UICornerFrame.CornerRadius = UDim.new(0, 15)

    -- Cadre avec bordure néon vert
    local UIStroke = Instance.new("UIStroke", Frame)
    UIStroke.Thickness = 3
    UIStroke.Color = Color3.fromRGB(0, 255, 128)
    UIStroke.Transparency = 0
    UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

    -- Titre
    local Title = Instance.new("TextLabel", Frame)
    Title.Size = UDim2.new(1, 0, 0, 40)
    Title.Position = UDim2.new(0, 0, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "Paramètres"
    Title.TextColor3 = Color3.fromRGB(0, 255, 128)
    Title.Font = Enum.Font.Gotham
    Title.TextScaled = true

    -- ScrollingFrame pour les boutons
    local Scroll = Instance.new("ScrollingFrame", Frame)
    Scroll.Size = UDim2.new(1, -20, 1, -100) -- Hauteur réduite pour laisser la place aux boutons du bas
    Scroll.Position = UDim2.new(0, 10, 0, 50)
    Scroll.BackgroundTransparency = 1
    Scroll.BorderSizePixel = 0
    Scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    Scroll.ScrollBarThickness = 6
    Scroll.VerticalScrollBarInset = Enum.ScrollBarInset.Always
    Scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y

    local UIListLayout = Instance.new("UIListLayout", Scroll)
    UIListLayout.Padding = UDim.new(0, 8)
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

    -- Fonction pour créer un bouton simple style flshty noir/vert
    local function creerBouton(nom, callback)
        local btn = Instance.new("TextButton", Scroll)
        btn.Size = UDim2.new(0.95, 0, 0, 40)
        btn.BackgroundColor3 = Color3.fromRGB(0, 50, 20)
        btn.TextColor3 = Color3.fromRGB(0, 255, 128)
        btn.Font = Enum.Font.Gotham
        btn.TextScaled = true
        btn.Text = nom
        local uicorner = Instance.new("UICorner", btn)
        uicorner.CornerRadius = UDim.new(0, 12)
        local uistroke = Instance.new("UIStroke", btn)
        uistroke.Color = Color3.fromRGB(0, 255, 128)
        uistroke.Thickness = 0.5

        btn.MouseButton1Click:Connect(function()
            pcall(callback)
            btn.AutoButtonColor = false
            btn.BackgroundColor3 = Color3.fromRGB(0, 30, 12)
            btn.Text = "✔️ " .. nom
        end)
    end

    -- Fonction pour créer un bouton toggle style flshty noir/vert
    local function creerToggle(nom, texteOn, texteOff, onFunc, offFunc, etatInitial)
        local etat = etatInitial
        local btn = Instance.new("TextButton", Scroll)
        btn.Size = UDim2.new(0.95, 0, 0, 40)
        btn.BackgroundColor3 = Color3.fromRGB(0, 50, 20)
        btn.TextColor3 = Color3.fromRGB(0, 255, 128)
        btn.Font = Enum.Font.Gotham
        btn.TextScaled = true
        btn.Text = etat and (texteOn .. " (ON)") or (texteOff .. " (OFF)")
        local uicorner = Instance.new("UICorner", btn)
        uicorner.CornerRadius = UDim.new(0, 12)
        local uistroke = Instance.new("UIStroke", btn)
        uistroke.Color = Color3.fromRGB(0, 255, 128)
        uistroke.Thickness = 1

        btn.MouseButton1Click:Connect(function()
            etat = not etat
            if etat then
                pcall(onFunc)
                btn.Text = texteOn .. " (ON)"
            else
                pcall(offFunc)
                btn.Text = texteOff .. " (OFF)"
            end
        end)
    end

    -- Ajout des boutons avec leurs fonctions associées

    creerBouton("Supprimer Brouillard / Flou", function()
        local eclairage = game:GetService("Lighting")
        for _, v in pairs(eclairage:GetChildren()) do
            if v:IsA("BlurEffect") or v:IsA("DepthOfFieldEffect") or v:IsA("SunRaysEffect") then
                v:Destroy()
            end
        end
        eclairage.FogStart = 999999
        eclairage.FogEnd = 999999
    end)

    creerBouton("Supprimer Ciel", function()
        local eclairage = game:GetService("Lighting")
        for _, v in pairs(eclairage:GetChildren()) do
            if v:IsA("Sky") then v:Destroy() end
        end
    end)

    creerBouton("Fullbright (lumière maximale)", function()
        local eclairage = game:GetService("Lighting")
        eclairage.Brightness = 3
        eclairage.ClockTime = 12
        eclairage.FogEnd = 1e10
        eclairage.GlobalShadows = false
    end)

    creerToggle("Fling", "Fling", "Fling", function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Flashtynooo/Roblox/refs/heads/Fighting-style/Fling%20on"))()
    end, function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Flashtynooo/Roblox/refs/heads/Fighting-style/Fling%20off"))()
    end, false)

    creerToggle("Antifling", "Antifling", "Antifling", function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Flashtynooo/Roblox/refs/heads/Fighting-style/Antifling"))()
    end, function()
        _G.g_antiFling = false
    end, false)

    -- Boutons fixes en bas hors du scrolling
    local function creerBoutonFixe(nom, callback)
        local btn = Instance.new("TextButton", Frame)
        btn.Size = UDim2.new(0.45, 0, 0, 40)
        btn.Position = UDim2.new(nom == "Rejoindre" and 0.05 or 0.5, 0, 1, -45)
        btn.BackgroundColor3 = Color3.fromRGB(0, 50, 20)
        btn.TextColor3 = Color3.fromRGB(250, 255, 128)
        btn.Font = Enum.Font.Gotham
        btn.TextScaled = true
        btn.Text = nom
        local uicorner = Instance.new("UICorner", btn)
        uicorner.CornerRadius = UDim.new(0, 12)
        local uistroke = Instance.new("UIStroke", btn)
        uistroke.Color = Color3.fromRGB(0, 255, 128)
        uistroke.Thickness = 0.5

        btn.MouseButton1Click:Connect(function()
            pcall(callback)
            btn.AutoButtonColor = false
            btn.BackgroundColor3 = Color3.fromRGB(0, 30, 12)
            btn.Text = ":) " .. nom
        end)
    end

    creerBoutonFixe("Rejoindre", function()
        local teleportService = game:GetService("TeleportService")
        local joueur = game.Players.LocalPlayer
        teleportService:Teleport(game.PlaceId, joueur)
    end)

    creerBoutonFixe("Changer de serveur", function()
        local HttpService = game:GetService("HttpService")
        local TeleportService = game:GetService("TeleportService")
        local PlaceId = game.PlaceId
        local UrlListeServeurs = "https://games.roblox.com/v1/games/" .. PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"

        local function demanderListeServeurs(cursor)
            local url = UrlListeServeurs
            if cursor then
                url = url .. "&cursor=" .. cursor
            end
            local success, response = pcall(function()
                return game:HttpGet(url)
            end)
            if success and response then
                return HttpService:JSONDecode(response)
            else
                return nil
            end
        end

        local function teleporterVersNouveauServeur()
            local serveurs = demanderListeServeurs()
            if not serveurs or not serveurs.data then return end

            local idServeur = nil
            local joueur = game.Players.LocalPlayer

            for _, s in pairs(serveurs.data) do
                if s.playing < s.maxPlayers then
                    idServeur = s.id
                    break
                end
            end

            if idServeur then
                TeleportService:TeleportToPlaceInstance(PlaceId, idServeur, joueur)
            else
                warn("Aucun serveur disponible pour le téléport.")
            end
        end

        teleporterVersNouveauServeur()
    end)
end
